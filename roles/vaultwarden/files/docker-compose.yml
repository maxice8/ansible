services:
  vaultwarden:
    image: vaultwarden/server:latest
    container_name: vaultwarden
    restart: unless-stopped
    labels:
      caddy: vault.maxice8.com
      caddy.reverse_proxy: "{{upstreams 80}}"
    environment:
      - DOMAIN=https://vault.maxice8.com
      - EXPERIMENTAL_CLIENT_FEATURE_FLAGS=fido2-vault-credentials,ssh-key-vault-item,ssh-agent
      - SIGNUPS_ALLOWED=False
      - IP_HEADER=Cf-Connecting-IP
    env_file: "admin_token.env"
    volumes:
      - ./vw-data/:/data/
    networks: 
      - caddy_network

networks:
  caddy_network:
    name: caddy_network
    external: true