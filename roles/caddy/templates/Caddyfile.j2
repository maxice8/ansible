{
    crowdsec {
        api_key {{ caddy_crowdsec_api_key }}
    }
    servers {
        metrics
    }
    # Global options block
    log {
        output file /var/log/caddy/caddy_main.log {
            roll_size 100MiB
            roll_keep 5
            roll_keep_for 100d
        }
        format json
        level INFO
    }
}

:2019 {
    metrics
}

{% if 'vaultwarden' in services -%}
vault.maxice8.com {
    reverse_proxy localhost:30001
    route {
        crowdsec
    }
    log {
        output file /var/log/caddy/vault.maxice8.com.log {
            roll_size 100MiB
            roll_keep 5
            roll_keep_for 100d
        }
        format json
        level INFO
    }
}
{% endif -%}
{% if 'forgejo' in services -%}
git.maxice8.com {
    reverse_proxy localhost:30002
    route {
        crowdsec
    }
    log {
        output file /var/log/caddy/git.maxice8.com.log {
            roll_size 100MiB
            roll_keep 5
            roll_keep_for 100d
        }
        format json
        level INFO
    }
}
{% endif -%}
{% if 'whoami' in services -%}
whoami.maxice8.com {
    reverse_proxy localhost:30003
    route {
        crowdsec
    }
    log {
        output file /var/log/caddy/whoami.maxice8.com.log {
            roll_size 100MiB
            roll_keep 5
            roll_keep_for 100d
        }
        format json
        level INFO
    }
}
{% endif -%}